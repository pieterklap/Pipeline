##Start## "comet"

# check where comet is installed
PIDprog=$(grep "Comet " "$LOC"install_locations | awk '{print $2}')
# looks if comet.exe is a command if it is it runs it and if not it exits
if [[ $PIDprog == "" ]] || [ ! -f $PIDprog ]; then
    echo -e "\e[93mWARNING:\e[0m The location of comet is not given or does not exist"
    PIDprog=$(command -v comet.exe)
    if [[ $PIDprog == "" ]]; then
        PIDprog=$(command -v comet)
    fi
    if [[ $PIDprog == "" ]]; then
        echo -e "\e[91mERROR:\e[0m comet was not found. \nexiting"
        exit
    else
        echo -e "\e[92mRunning:\e[0m $PIDprog"
    fi
fi
#   if the output_suffix is entered in the command line change it in the parameterfile
if [[ $output_suffix != "" ]]; then
    sed -i "s/output_suffix = .*/output_suffix = $output_suffix/" $PIDparam
fi

# run comet
"$PIDprog" -P"$PIDparam" "$PIDinput" |& tee -a $datelog

#   if the output_suffix is NOT entered in the command line take the output suffix from the parameter file
if [[ $output_suffix == "" ]]; then
    output_suffix=$(grep "output_suffix =" $PIDparam | awk '{print $3}')
fi
#   Changes the Name of comet output (is also used in comet2pin)
if [[ $COMEToutput == "" ]]; then
    EXTENTION=$(echo "$PIDinput" |awk -F. '{print $NF}')
    COMEToutput=$(echo $PIDinput | sed "s/\.$EXTENTION/$output_suffix\.pep\.xml/")
    NAME_Cometoutput=$(echo $COMEToutput | awk -F/ '{print $NF}')
fi
PIDoutput="$PIDoutput/$NAME_Cometoutput"
mv "$COMEToutput" "$PIDoutput"


##End## "comet"
