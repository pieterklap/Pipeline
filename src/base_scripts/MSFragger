## Start ## "MSFragger"

#input:     mzML
Extention=$(echo $PIDinput | awk -F. '{print $NF}')
Fraggerout=$(echo $PIDinput | sed "s/$Extention/pepXML/")

#   Checks if/where MSFragger (version 20190222) is installed if it is not installed it will look for the .jar file.
#   if more than 1 .jar files are found it will take the last one (the latest one if the location is the same).
PIDprog=$(grep "MSFragger " "$LOC"install_locations | awk '{print $2}')
if [[ $PIDprog == "" ]] || [ ! -f $PIDprog ]; then
    echo -e "\e[93mWARNING:\e[0m The location of MSFragger is not given or does not exist"
    PIDprog=$(command -v MSFragger-20190222.jar)
    if [[ $PIDprog == "" ]]; then
        PIDprog=$(locate -b MSFragger*.jar | tail -n1)
    fi
    if [[ $PIDprog == "" ]]; then
        echo -e "\e[91mERROR:\e[0m MSFragger was not found. \nexiting"
        exit
    else
        echo -e "\e[92mRunning:\e[0m $PIDprog"
    fi
fi

MemUse=$(grep "^#Mem_Use" $PIDparam | awk '{print $2}')

if [[ $MemUse == "" ]]; then
    MemUse="4G"
fi


java -Xmx"$MemUse" $JavaOptions -jar $PIDprog $PIDparam $PIDinput

NAMEfraggerout=$(echo $Fraggerout | awk -F/ '{print $NF}' | sed "s/\.pepXML/$output_suffix\.pep.xml/")
PIDoutput=$PIDoutput/$NAMEfraggerout

mv $Fraggerout $PIDoutput 

if [ -f $PIDoutput ]; then
    if [ ! -s $PIDoutput ]; then
        echo "$PIDoutput is empty"
        echo "something went wrong running $PIDprog"
    fi
else
    echo "$PIDoutput is not a file"
    echo "something went wrong running $PIDprog"
    exit
fi

## End ## "MSFragger"
