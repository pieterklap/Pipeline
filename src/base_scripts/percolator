##Start## "percolator"

VALprog=$(grep "percolator " "$LOC"install_locations | awk '{print $2}')
if [[ $VALprog == "" ]] || [ ! -f $VALprog ]; then
    echo -e "\e[93mWARNING:\e[0m The location of percolator is not given or does not exist"
    VALprog=$(command -v percolator)
    if [[ $VALprog == "" ]]; then
        echo -e "\e[91ERROR:\e[0m percolator was not found. \nexiting"
        exit
    else
        echo -e "\e[92mRunning:\e[0m $VALprog"
    fi
fi

EXTENTION=$(echo $PIDoutput | awk -F. '{print $NF}')
VALoutput=$(echo $PIDoutput | sed "s/$EXTENTION/put.xml/")
TSVoutput=$(echo $PIDoutput | sed "s/$EXTENTION/put.tsv/")

#   if no parameter file was given do not search the non existent parameter file
if [[ $VALparam != "" ]]; then
    VALparam=$(grep -v "^#" $VALparam | awk '{print $1, $2}' | tr "\n" " ")
fi

#   Run percolator
$VALprog -X $VALoutput $VALparam $PIDoutput -r $TSVoutput |& tee -a $datelog 

if [ -f $VALoutput ]; then
    if [ ! -s $VALoutput ]; then
        echo -e "\e[91mERROR:\e[0m $VALoutput is empty" | tee -a $datelog
        exit
    fi
else
    echo -e "\e[91mERROR:\e[0m $VALoutput is not a file" | tee -a $datelog
    exit
fi

##End## "percolator"
