##Start## "Xtandem"

# Stes the location of tandem into a variable
PIDprog=$(grep "Tandem " "$LOC"install_locations | awk '{print $2}')
# if the given location isn't a file try to find tandem.
if [[ $PIDprog == "" ]] || [ ! -f $PIDprog ]; then
    echo -e "\e[93mWARNING:\e[0m The location of Tandem is not given or does not exist"
    PIDprog=$(command -v tandem.exe)
    if [[ $PIDprog == "" ]]; then
        echo -e "\e[91mERROR:\e[0m Tandem was not found. \nexiting"
        exit
    else
        echo -e "\e[92m running\e[0m $PIDprog"
    fi
fi

# sets the program location to XTloc
XTloc=$PIDprog
# changes XTloc to the directory of tandem.exe
XTloc=$(echo "$XTloc" |awk -F/ '{$NF="";print $0}' | tr " " "/")

#XTfasta=$(echo "$XTloc""fasta/" )
#TAXON=$(head -n1 $XTfasta |awk '{print $1}'| awk -F_ '{print $2}')

# input.xml
# creates varable to be able t be used in sed
mkdir "$LOC".tandemtemp
inputXT=${PIDinput//\//\\/}        # sets backslashes in front of forward slashes for use with sed
outputXT=${PIDoutput//\//\\/}      # sets backslashes in front of forward slashes for use with sed

XTbin=$(echo "$PIDparam" |awk -F/ '{$NF="";print $0}' | tr " " "/")


# Changes the paths in the input.xml file

sed "s/\"spectrum, path\".*/\"spectrum, path\">$inputXT<\/note>/" "$PIDparam" > "$LOC".tandemtemp/input.xml # Changes the input path to the reque$

sed "s/\"output, path\".*/\"output, path\">$outputXT\/output.xml<\/note>/" "$LOC".tandemtemp/input.xml > "$PIDparam"  # Changes the output path to$

# run Xtandem
$PIDprog $PIDparam |& tee -a $datelog

# remove the temporary directory
rm -fr "$LOC".tandemtemp/

PIDoutput=$(ls -t $PIDoutput/* |head -n1)
##End## "Xtandem"
